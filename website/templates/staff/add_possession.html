{% extends 'base.html' %}
{% block title %}Ajouter une Possession{% endblock %}
{% block extra_head %}
        body {
            background-image: linear-gradient(to bottom right, #8C1F28, #D92525) !important;
        }
        main {
            padding: 0; /* Remove padding for full-width content */
        }
{% endblock %}
{% block content %}
<div class="min-h-screen flex items-center justify-center py-12" style="height:fit-content; min-height: 75vh;">
    <div class="glass p-8 rounded-2xl shadow-2xl w-full max-w-md animate-fade-in-up">
        <h1 class="text-3xl font-bold text-center text-[#044040] mb-6">Ajouter une Possession pour {{ citizen.username }}</h1>
        <form method="post" class="space-y-6" id="add-possession-form">
            {% csrf_token %}
            <div>
                <label for="category" class="block text-sm font-medium text-[#000000]">Catégorie</label>
                <select name="category" id="category" required 
                        class="mt-1 block w-full p-3 bg-[#F2F2F2]/10 border border-[#000000] rounded-lg text-[#000000] focus:outline-none focus:ring-2 focus:ring-[#044040] focus:border-transparent transition-all duration-300 hover-scale">
                    <option value="" disabled selected>Sélectionner une catégorie</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="possession_type" class="block text-sm font-medium text-[#000000]">Type de possession</label>
                <select name="possession_type" id="possession_type" required 
                        class="mt-1 block w-full p-3 bg-[#F2F2F2]/10 border border-[#000000] rounded-lg text-[#000000] focus:outline-none focus:ring-2 focus:ring-[#044040] focus:border-transparent transition-all duration-300 hover-scale">
                    <option value="" disabled selected>Sélectionner un type</option>
                </select>
            </div>
            <div>
                <label for="description" class="block text-sm font-medium text-[#000000]">Description</label>
                <textarea name="description" id="description" required 
                          class="mt-1 block w-full p-3 bg-[#F2F2F2]/10 border border-[#000000] rounded-lg text-[#000000] placeholder-[#000000]/50 focus:outline-none focus:ring-2 focus:ring-[#044040] focus:border-transparent transition-all duration-300"></textarea>
            </div>
            <div>
                <label for="acquisition_date" class="block text-sm font-medium text-[#000000]">Date d'acquisition</label>
                <input type="date" name="acquisition_date" id="acquisition_date" required 
                       class="mt-1 block w-full p-3 bg-[#F2F2F2]/10 border border-[#000000] rounded-lg text-[#000000] focus:outline-none focus:ring-2 focus:ring-[#044040] focus:border-transparent transition-all duration-300 hover-scale">
            </div>
            <div>
                <label for="estimated_value" class="block text-sm font-medium text-[#000000]">Valeur estimée (MAD)</label>
                <input type="number" step="0.01" name="estimated_value" id="estimated_value" required 
                       class="mt-1 block w-full p-3 bg-[#F2F2F2]/10 border border-[#000000] rounded-lg text-[#000000] placeholder-[#000000]/50 focus:outline-none focus:ring-2 focus:ring-[#044040] focus:border-transparent transition-all duration-300 hover-scale">
            </div>
            <button type="submit" 
                    class="w-full bg-gradient-to-r from-[#D92525] to-[#8C1F28] text-[#F2F2F2] p-3 rounded-lg font-semibold hover:from-[#591C21] hover:to-[#D92525] transition-all duration-300 hover-scale animate-pulse">
                Ajouter
            </button>
        </form>
    </div>
</div>
<script>
    document.getElementById('category').addEventListener('change', function() {
        const categoryId = this.value;
        const possessionTypeSelect = document.getElementById('possession_type');
        possessionTypeSelect.innerHTML = '<option value="" disabled selected>Chargement...</option>';
        
        fetch(`/api/possession-types/${categoryId}/`, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            possessionTypeSelect.innerHTML = '<option value="" disabled selected>Sélectionner un type</option>';
            data.forEach(type => {
                const option = document.createElement('option');
                option.value = type.id;
                option.textContent = `${type.name} (${type.point_value} points)`;
                possessionTypeSelect.appendChild(option);
            });
        })
        .catch(error => {
            possessionTypeSelect.innerHTML = '<option value="" disabled selected>Erreur de chargement</option>';
        });
    });
</script>
{% endblock %}
